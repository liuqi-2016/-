### 新增移除账号

> ## useradd
> 相关配置: passwd, usermod, userdel

1. 新增用户
```
useradd [-u UID] [-g 初始群组] [-G 次要群组] [-mM] [-c 说明栏] [-d 家目录绝对路径] [-s shell] 新账号名
```
2. 默认处理项:
```
在 /etc/passwd 里面创建一行与账号相关的数据，包括创建 UID/GID/家目录等；
在 /etc/shadow 里面将此账号的口令相关参数填入，但是尚未有口令；
在 /etc/group 里面加入一个与账号名称一模一样的组名；
在 /home 底下创建一个与账号同名的目录作为用户家目录且权限为 700
	如果使用参数[-r]就是创建系统账号，此时不会主动创建家目录
```
3. useradd参考档
> 即在新增账号的时候，需要查找默认的配置项所在的文档

	useradd -D

显示结果：
``` 
GROUP=100		<==默认的群组
HOME=/home		<==默认的家目录所在目录
INACTIVE=-1		<==口令失效日，在 shadow 内的第 7 栏
EXPIRE=			<==账号失效日，在 shadow 内的第 8 栏
SHELL=/bin/bash		<==默认的 shell
SKEL=/etc/skel		<==用户家目录的内容数据参考目录
CREATE_MAIL_SPOOL=yes   <==是否主动帮使用者创建邮件信箱(mailbox)
```
`解析：`
* `GROUP=100：新建账号的初始群组使用GID为100`
	* `两种机制创建群组：`
		* `私有群组：系统创建一个与账号一样的群组给新建的账号使用，家目录默认权限是700，只有自己能访问`
		* `公有群组：就是以GROUP=100为新建账号的群组，默认家目录权限 766，属于这个群组的都可以进入别人的家目录`
* `HOME=/home：用户家目录的基准目录，就是新建的账号会在这里新建一个同样名称的目录，这个目录就是新建账号的家目录`
* `INACTIVE=-1：口令过期后是否会失效的配置值`
* `EXPIRE=：账号失效的日期`
* `SHELL=/bin/bash：默认使用的 shell 程序文件名`
* `SKEL=/etc/skel：用户家目录参考基准目录，账号家目录结构的模板`
* `CREATE_MAIL_SPOOL=yes：创建使用者的 mailbox`

> 其他信息参考档在：/etc/login.defs 文件

	里面定义了 邮件目录，是否创建家目录，删除用户时 所属群组没有用户了是否也将群组一并删除等

> 至此，useradd 新建账号参考模板文档有：

	/etc/default/useradd
	/etc/login.defs
	/etc/skel

4. 设置修改口令
```
passwd [账号]

	不跟账号，就是修改当前账号的密码
```
`参数：`

* `--stdin ：可以透过来自前一个管线的数据，作为口令输入，对 shell script 有帮助！`
* `-l  ：是 Lock 的意思，会将 /etc/shadow 第二栏最前面加上 ! 使口令失效；`
* `-u  ：与 -l 相对，是 Unlock 的意思！`
* `-S  ：列出口令相关参数，亦即 shadow 文件内的大部分信息。`
* `-n  ：后面接天数，shadow 的第 4 字段，多久不可修改口令天数`
* `-x  ：后面接天数，shadow 的第 5 字段，多久内必须要更动口令`
* `-w  ：后面接天数，shadow 的第 6 字段，口令过期前的警告天数`
* `-i  ：后面接『日期』，shadow 的第 7 字段，口令失效日期`

	密码使用PAM模块管理，管理机制在/etc/pam.d/passwd

5. 修改口令
```
chage 账号
```
`参数：`
* `-l ：列出该账号的详细口令参数；`
* `-d ：后面接日期，修改 shadow 第三字段(最近一次更改口令的日期)，格式 YYYY-MM-DD`
* `-E ：后面接日期，修改 shadow 第八字段(账号失效日)，格式 YYYY-MM-DD`
* `-I ：后面接天数，修改 shadow 第七字段(口令失效日期)`
* `-m ：后面接天数，修改 shadow 第四字段(口令最短保留天数)`
* `-M ：后面接天数，修改 shadow 第五字段(口令多久需要进行变更)`
* `-W ：后面接天数，修改 shadow 第六字段(口令过期前警告日期)`

6. 修改账号
```
usermod 账号
```
`参数：`
* `-c  ：后面接账号的说明，即 /etc/passwd 第五栏的说明栏，可以加入一些账号的说明。`
* `-d  ：后面接账号的家目录，即修改 /etc/passwd 的第六栏；`
* `-e  ：后面接日期，格式是 YYYY-MM-DD 也就是在 /etc/shadow 内的第八个字段数据啦！`
* `-f  ：后面接天数，为 shadow 的第七字段。`
* `-g  ：后面接初始群组，修改 /etc/passwd 的第四个字段，亦即是 GID 的字段！`
* `-G  ：后面接次要群组，修改这个使用者能够支持的群组，修改的是 /etc/group 啰～`
* `-a  ：与 -G 合用，可『添加次要群组的支持』而非『配置』喔！`
* `-l  ：后面接账号名称。亦即是修改账号名称， /etc/passwd 的第一栏！`
* `-s  ：后面接 Shell 的实际文件，例如 /bin/bash 或 /bin/csh 等等。`
* `-u  ：后面接 UID 数字啦！即 /etc/passwd 第三栏的数据；`
* `-L  ：暂时将用户的口令冻结，让他无法登陆。其实仅改 /etc/shadow 的口令栏。`
* `-U  ：将 /etc/shadow 口令栏的 ! 拿掉，解冻啦！`

7. 删除账号
	`最好是禁用一个账号，而不是删除它`
```
userdel 账号
```
`参数：`
* `-r  ：连同用户的家目录也一起删除`

`删除的用户信息包含：`

* `用户账号/口令相关参数：/etc/passwd, /etc/shadow`
* `使用者群组相关参数：/etc/group, /etc/gshadow`
* `用户个人文件数据： /home/username, /var/spool/mail/username..`

---

> 以上用户相关命令都是**root**使用的，普通用户使用的如下：

8. 查看账户信息
```
finger 账号
	不接账号，查看的是当前登录账号的信息
```

9. 改变账户信息
```
chfn 账号
	不接账号，改变的是当前登录账号的信息，设置账号名，电话等附加信息
```

10. 改变使用的Shell
```
chsh
```

11. id，列出所有的id
```
id 账号
	不接账号，显示的是当前登录账号的id
```

### 新增移除群组
> 相关文件: /etc/group, /etc/gshadow
1. 新增群组
```
groupadd [-g gid] [-r] 组名
```
`参数：`
* `-g  ：后面接某个特定的 GID ，用来直接给予某个 GID`
* `-r  ：创建系统群组啦！与 /etc/login.defs 内的 GID_MIN 有关`

2. 修改群组
```
groupmod [-g gid] [-n gname] 群组名
```

3. 删除群组
```
groupdel gname
	群组有分配的账号，不能被删除
```

4. 群组管理员
> 4.1 系统管理员的动作：
```
gpasswd gname
```
`参数：`
* `    ：若没有任何参数时，表示给予 groupname 一个口令(/etc/gshadow)`
* `-A  ：将 groupname 的主控权交由后面的使用者管理(该群组的管理员)`
* `-M  ：将某些账号加入这个群组当中！`
* `-r  ：将 groupname 的口令移除`
* `-R  ：让 groupname 的口令栏失效`
> 4.2 群组管理员的动作：
```
gpasswd [-ad] user gname
```
`参数：`
* `-a  ：将某位使用者加入到 groupname 这个群组当中！`
* `-d  ：将某位使用者移除出 groupname 这个群组当中。`

5. 